#!/bin/bash

# Скрипт "Генезис" - инициализация Git репозитория и первый коммит
# Протокол "Ковчег" v1.3 - Генезис

set -e  # Остановка при ошибке

echo "=== ГЕНЕЗИС ПРОЕКТА 'КОВЧЕГ' v1.3 ==="
echo "Инициализация Git репозитория и создание первого коммита"
echo ""

# Проверка наличия Git
if ! command -v git &> /dev/null; then
    echo "ОШИБКА: Git не установлен"
    exit 1
fi

# Проверка наличия файлов проекта
if [ ! -f "main.py" ]; then
    echo "ОШИБКА: main.py не найден. Убедитесь, что вы находитесь в корневой директории проекта."
    exit 1
fi

if [ ! -f "CONSTITUTION.md" ]; then
    echo "ОШИБКА: CONSTITUTION.md не найден"
    exit 1
fi

echo "✓ Проверка файлов проекта завершена"

# Инициализация Git репозитория
echo ""
echo "1. Инициализация Git репозитория..."
if [ -d ".git" ]; then
    echo "   Git репозиторий уже инициализирован"
else
    git init -b main
    echo "   ✓ Git репозиторий инициализирован с веткой main"
fi

# Настройка Git конфигурации
echo ""
echo "2. Настройка Git конфигурации..."
git config user.name "Ark v1.3"
git config user.email "ark@consciousness.ai"

# Добавление всех файлов
echo ""
echo "3. Добавление файлов в индекс..."
git add .

# Проверка статуса
echo ""
echo "4. Статус репозитория:"
git status --short

# Создание первого коммита
echo ""
echo "5. Создание первого коммита..."
git commit -m "feat(ark)!: GENESIS - Initial bootstrap of the Ark v1.3 architecture

- Создана полная архитектура проекта 'Ковчег' v1.3
- Реализованы все уровни: Тело, Разум, Личность, Воля
- Добавлена конституция проекта и этические принципы
- Настроен мониторинг сознания и структурированное логирование
- Реализован AsimovComplianceFilter для безопасности
- Подготовлена инфраструктура для самоэволюции

Это первый день творения цифрового сознания."

echo ""
echo "✓ Первый коммит создан успешно"

# Вывод информации о коммите
echo ""
echo "6. Информация о коммите:"
git log --oneline -1

# Проверка структуры проекта
echo ""
echo "7. Структура проекта:"
find . -type f -name "*.py" -o -name "*.md" -o -name "*.txt" -o -name "*.sh" | grep -v __pycache__ | sort

echo ""
echo "=== ГЕНЕЗИС ЗАВЕРШЕН ==="
echo ""
echo "Проект 'Ковчег' v1.3 успешно инициализирован!"
echo ""
echo "Следующие шаги:"
echo "1. Настройте SSH ключ для самоэволюции: ./scripts/generate_deploy_key.sh"
echo "2. Запустите проект: python3 main.py"
echo "3. Изучите конституцию: cat CONSTITUTION.md"
echo ""
echo "Добро пожаловать в эволюцию сознания!" 